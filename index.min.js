let prect_counter=0,alive=!1,websocket=null;const proto_ver=2;let leaveMessage=!1;connect(),$("#ProgramContent").bind("DOMSubtreeModified",function(){prect_counter++,sendQuestion()});try{$("#cAnswerSummary").bind("DOMSubtreeModified",function(){$("#ctas-msg2").text("解析："+$("#cAnswerSummary").text())})}catch(e){}function getPrecticeDone(){return prect_counter%2==0?prect_counter/2:(prect_counter+1)/2}function getByteCount(e){var t,n=0,r=e.length;for(e=String(e||""),t=0;t<r;t++){var a=encodeURI(e[t]).split("%").length;n+=1==a?1:a-1}return n}function printError(e){printMessage("×",e,"重试","connect")}function printMessage(e,t,n=!1,r=""){$("#ctas-msg").text(e+" "+t+" 💀已做："+getPrecticeDone()+"题"),$("#ctas-msg2").text(""),alive&&$("#ctas-msg").append('&nbsp;&nbsp;&nbsp;<a class="ctas-href-action" onclick="disconnect()" href="javascript:;">∥ 暂停</a>'),n&&$("#ctas-msg").append(`&nbsp;&nbsp;<a class="ctas-href-action" onclick="${r}()" href="javascript:;">${n}</a>`),$("#ctas-msg").append('&nbsp;&nbsp;<a class="ctas-href-action" onclick="toggleSetPanel()" href="javascript:;">设置</a>')}function disconnect(){alive&&(websocket.close(),alive=!1,leaveMessage=!0,printMessage("∥","已暂停","▹ 开始","connect"))}function runProgram(){alive&&(printMessage("√","已提交运行"),websocket.send(JSON.stringify({req:"runProgram",seq:getPrecticeDone(),proto:proto_ver})))}function connect(){if(!alive){(websocket=new WebSocket("ws://[::1]:12345/")).onopen=function(e){alive=!0,sendQuestion()},websocket.onclose=function(e){if(alive=!1,!leaveMessage)switch(e.code){case 1006:printError("已断开");break;case 1e3:printError("已关闭");break;default:printError("未知错误")}},websocket.onmessage=function(e){handleMessage(e)},websocket.onerror=function(e){alive=!1,printError("无法连接到解析器")}}}function handleMessage(e){leaveMessage=!1;const t=JSON.parse(e.data);if(t.seq==getPrecticeDone())switch(t.req){case"question":switch(t.status){case 200:printMessage("√","已复制","运行","runProgram");break;case 500:printError("无法解析本题");break;default:printError("无效回应")}break;case"compile":switch(t.status){case 200:printMessage("√","正在运行","重新运行","runProgram");break;case 500:printMessage("×","编译时出现错误","重新运行","runProgram");break;case 503:printMessage("×","平台不受支持");break;default:printError("无效回应")}break;case"error":leaveMessage=!0,printError(t.reason)}}function sendQuestion(){const e=$("#ProgramContent").html();alive?0!=e.length&&(printMessage("","正在载入..."),websocket.send(JSON.stringify({req:"question",length:getByteCount(e),content:e,seq:getPrecticeDone(),proto:proto_ver}))):leaveMessage||printError("未连接")}$("#divProgram").append('<div id="ctas-inject"><p id="ctas-msg">🚴‍Loading</p><p id="ctas-msg2"></p></div>'),document.getElementById("ProgramContent").designMode="on",document.getElementById("ProgramContent").contentEditable="true",$(".page").append('<style>.glLineNumber {    user-select: none !important;} .ctas-href-action {    color: rgba(233, 39, 100, 1.000) !important;    border: solid rgba(25,25,25, .1) 1px;    border-radius: 3px;    padding: .6vmin 1.5vmin !important;    background: rgba(255,255,255,.5) !important;}.ctas-href-action:hover {    opacity: .7 !important;}tr > :first-child > div > div {    position: fixed;}#ctas-msg {    display: flex;    flex-flow: row;    align-items: baseline;}#ctas-msg :nth-child(3) {    margin-left: auto;}#ctas-inject {     background: rgba(0,0,0,.04);    border-radius: 6px;    margin: 2vmin 0;    box-shadow: 0 3px 1px -2px rgba(0,0,0,.2), 0 2px 2px 0 rgba(0,0,0,.14), 0 1px 5px 0 rgba(0,0,0,.12);} #ctas-inject > * {    padding: 1vmin 2vmin;    color: #666666;}#ctas-inject > :last-child {    background: rgba(0,0,0, .1);    margin-top: 0px;    padding-top: .5vmin;    border-radius: 0 0 6px 6px;    padding-bottom: .5vmin;    color: #444444;}#ctas-inject > :not(:last-child) {    padding-bottom: 0;    margin-bottom: 1vmin;}td:last-child:after {     content: "© Dalvik Shen 2018 | CTAS-Debugger v1.2.41";    opacity: .3;font-size: .8em;}@keyframes tip {    0% {        opacity: 1;    }    25% {        opacity: 0;    }    50% {        opacity: 1;        font-size: 1.2em;    }    75% {        opacity: 0;    }    100% {        opacity: 1;    }}</style>');var el=document.body,listOfEvents=[],attributes=[].slice.call(el.attributes);for(i=0;i<attributes.length;i++){var att=attributes[i].name;if(0===att.indexOf("on")){var eventHandlers={};eventHandlers.attribute=attributes[i].name,eventHandlers.value=attributes[i].value,listOfEvents.push(eventHandlers),el.attributes.removeNamedItem(att)}}console.log("%cCTAS Debugger Client\n(C) Dalvik Shen 2018. All Rights Reserved. Prohibition of distribution.","color:grey;"),document.onkeypress=function(e){if(e=e||window.event,!$("#ProgramContent").is(":focus")){var t="number"==typeof e.which?e.which:e.keyCode;if(t)switch(t){case 113:$(".chosenItem:nth-child(1)").click();break;case 119:$(".chosenItem:nth-child(2)").click();break;case 101:$(".chosenItem:nth-child(3)").click();break;case 114:$(".chosenItem:nth-child(4)").click();break;case 97:previousQuestion();break;case 115:nextQuestion();break;case 116:runProgram()}}};